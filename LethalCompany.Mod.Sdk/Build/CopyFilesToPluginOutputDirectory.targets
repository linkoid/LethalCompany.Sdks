<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="GetCopyToPluginOutputItems">
    <ItemGroup>
      <CopyToPluginOutputItems Include="$(TargetPath)">
        <TargetPath>%(Filename)%(Extension)</TargetPath>
      </CopyToPluginOutputItems>
      <CopyToPluginOutputItems Include="$(OutputDirectory)**"
                               Exclude="@(CopyToPluginOutputItems)">
        <TargetPath>%(RecursiveDirectory)%(Filename)%(Extension)</TargetPath>
      </CopyToPluginOutputItems>
    
  </ItemGroup>
  </Target>
  
  <Target Name="CopyFilesToPluginOutputDirectory"
          DependsOnTargets="GetCopyToPluginOutputItems"
          AfterTargets="Build"
          BeforeTargets="Run">
    <Copy SourceFiles="@(CopyToPluginOutputItems)"
          DestinationFiles="@(CopyToPluginOutputItems->'$(PluginOutputDirectory)%(TargetPath)')"
          SkipUnchanged="true" />
  </Target>

</Project>